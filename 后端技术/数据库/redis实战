# Redis 实战

## Redis 系统设计

缓存雪崩

## Redis 分布式缓存


## Redis 持久化

Redis 一共有三种数据持久化的方案：
1. AOF（Append On File）日志：每执行一条写命令，就把该命令已追加的方式写到一个文件里。
    - 如果命令执行，但是日志还没记录就宕机了，可能忽悠数据丢失的风险。
    - 写日志是在主线程里执行的，可能会阻塞后续的操作。
    - 写回硬盘策略
        - Always 每次执行完写命令就同步日志到硬盘
        - Everysec 每秒一次把缓冲区的内容写到硬盘
        - No 由操作系统决定何时把缓冲区内容写到硬盘
    - AOF 重写机制
        - 避免 AOF 文件越来越大
        - 类似一次内存快照，用新的 AOF文件替换旧的。
        - 由单独的子进程 bgrewriteaof 来完成
        - 主线程正在执行的操作，会拷贝一份到缓冲区，子进程也就把缓冲区的内容拷贝到 AOF 文件。
2. RDB（Redis Database Backup）快照：将某一个时刻的内存数据，以二进制的方式写入磁盘。
    - `save` 命令，在主线程中执行，会阻塞主线程。
    - `bigsave` 命令，创建子进程来生成 RDB 文件，避免主线程阻塞。
3. 混合持久化方式：Redis4.0新增的方式，集成了 AOF 和 RBD 的优点。
    - AOF 日志丢失数据少，但是数据恢复慢；RDB快照容易丢数据，但是恢复快；
    - 混合持久化的方案：前半部分是 RDB快照，后部分是 AOF 增量数据；

