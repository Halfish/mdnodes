
### 异步任务

主要的异步任务
- 发短信、发In-App通知、发App Push、发飞书、语音通知。
- Approval
- Billing / BillingHighPriority
- PaymentNotification
- Dataset Async job

rq 原理是什么？

直接搞个通用的 kafka topic？
- AsyncJobType: enum
- params: 用不同的 proto message
  - func: string （写 if else 处理）


几个相关的类：
1. `fcc_backend.lib.msg_sender.MsgSender` 包含了发送 slack、飞书、手机通知、短信通知的逻辑。很乱。
2. `fcc_backend.lib.async_jobs`
   - MsgAsyncJob 发送基础的slack消息；发送heavy user到飞书。
   - UserNotificationAsyncJob 没有人用了
   - PhoneNotificationAsyncJob 发送 App Push
3. `fcc_backend.lib.utils` 里的 `push_notofication_by_user`。
4. `common.server.utils.async_job_utils`
    - `AsyncJobPipeline` 用于提交异步任务
    - `AsyncJob` 具体执行的任务，不同类型的放在不同的队列里。
    - `SendSlackAsyncJob`
    - `DatabaseAsyncJob`
    - `SendSmsAsyncJob`
    - `SendVoiceMsgAsyncJob`
    - `SendPhoneNotificationAstyncJob`
    - `ExecuteApprovalAsyncJob`
    - `BillingAsyncJob`
    - `BillingHighPriorityAsyncJob`
    - `PaymentNotificationAsyncJob`


几个基础的类：
1. `fcc_backend.lib.voice_msg_sender.VoiceMsgSender` 发送语音通知
2. `fcc_backend.lib.phone_msg_sender.PhoneMsgSender` 发送短信通知